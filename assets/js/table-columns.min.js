"use strict";(function(d,m){var b=d.i18n.__,e=d.element.createElement,t=d.components,p=t.Button,v=t.IconButton,f=t.Icon,g=(t.TextControl,e);window.productTableBlockComponents||(window.productTableBlockComponents={});function h(e){for(var t=[],a=e.querySelectorAll("li"),n=0;n<a.length;n+=1)t.push(a[n].dataset.slug);return t}function n(e){e.currentTarget.classList.remove("selected"),e.currentTarget.classList.remove("select-attribute"),e.currentTarget.classList.remove("select-custom"),"att"===e.currentTarget.value?e.currentTarget.classList.add("select-attribute"):"cf"===e.currentTarget.value||"tax"===e.currentTarget.value?e.currentTarget.classList.add("select-custom"):e.currentTarget.classList.add("selected")}function l(e){""===e.currentTarget.value?e.currentTarget.classList.remove("selected"):e.currentTarget.classList.add("selected")}function r(e){function t(e){var t=u[e].split(":"),a=[],n="",l="";-1===["att","cf","tax"].indexOf(t[0])&&1<t.length?(a.push(g("strong",{},t[1])),a.push(" ("+m.columnLabels[t[0]].heading+")"),n=t[1],l=t[0]):-1<["att","cf","tax"].indexOf(t[0])&&2<t.length?(a.push(g("strong",{},t[2])),a.push(" ("+m.columnLabels[t[0]].heading+")"),n=t[2],l=t[0]+":"+t[1]):(a.push(g("strong",{},m.columnLabels[t[0]].heading)),l=t[0],2===t.length&&(l+=":"+t[1])),-1<["att","cf","tax"].indexOf(t[0])&&1<t.length&&a.push(g("em",{},t[1]));var r=d.element.createRef(),c=d.element.createRef(),o=g("li",{"data-slug":u[e],key:"table-column-"+e},[g(f,{icon:barn2_reorderIcon,alt:""}),g(v,{className:"barn2-wc-product-table-block__edit-label-button",icon:"edit",alt:"Edit Column Name",title:"Edit Column Name","aria-expanded":"false",ref:r,onClick:function(e){"true"===e.currentTarget.getAttribute("aria-expanded")?e.currentTarget.setAttribute("aria-expanded","false"):e.currentTarget.setAttribute("aria-expanded","true")}}),g("input",{className:"barn2-wc-product-table-block__edit-label-input components-text-control__input",placeholder:"Edit Column Header",defaultValue:n,ref:c}),g(p,{className:"barn2-wc-product-table-block__save-label-button is-primary","data-index":e,"data-original":l,onClick:function(e){r.current.setAttribute("aria-expanded","false");var t=c.current.value,a=JSON.parse(JSON.stringify(u));a[e.currentTarget.dataset.index]=e.currentTarget.dataset.original,0<t.length&&(a[e.currentTarget.dataset.index]+=":"+t),s({newColumns:a})}},b("Done","wpt-block")),g("span",{className:"barn2-wc-product-table-block__column-label"},a),g(v,{className:"barn2-wc-product-table-block__delete-column",icon:barn2_deleteIcon,label:"Remove Column","data-index":e,onClick:function(e){s({newColumns:removeArrayIndex(u,e.currentTarget.dataset.index)})}})]);i.push(o)}var a=e.columnRef,u=e.columns,s=e.onChange,i=[];for(var n in u)t(n);return waitForReference(a,function(t){if(!t.classList.contains("ui-sortable")){var a=jQuery(t);a.sortable({update:function(){var e=h(t);a.sortable("cancel"),s({newColumns:e})}})}}),g("ul",{className:"barn2-wc-product-table-block__columns-selected",ref:a,"data-columns":u.join(",")},i)}window.productTableBlockComponents.ProductTableColumns=function(e){var t=e.columns,c=e.saveColumns,a=[g("h3",{},b("Table Columns","wpt-block"))],o=d.element.createRef();a.push(r({columnRef:o,columns:t,onChange:function(e){var t=e.newColumns;c(t)}})),a.push(g("p",{className:"empty-options"},b("(Using global options)","wpt-block")));var u=d.element.createRef(),s=d.element.createRef(),i=d.element.createRef();return a.push(g("select",{className:"barn2-wc-product-table-block__column-selector",onChange:n,ref:u},function(){var e=[g("option",{value:"",key:0},b("Add column","wpt-block"))];for(var t in m.columnLabels)e.push(g("option",{value:t,key:t},m.columnLabels[t].heading));return e}())),a.push(g("select",{className:"barn2-wc-product-table-block__attribute-selector",onChange:l,ref:s},function(){var e=[g("option",{value:"",key:0},b("Select global attribute","wpt-block"))];for(var t in m.columnLabels.att.values){var a=m.columnLabels.att.values[t];e.push(g("option",{value:a.attribute_name,key:a.attribute_id},a.attribute_label))}return e}())),a.push(g("input",{className:"barn2-wc-product-table-block__custom-input",onChange:l,ref:i})),a.push(g(p,{className:"components-button is-secondary barn2-wc-product-table-block__add-column-button",onClick:function(){var e,t,a,n,l,r=h(o.current);e={selection:u.current,attr:s.current,custom:i.current,columns:r},t=e.selection,a=e.attr,n=e.custom,l=e.columns,"att"===t.value?l.push(t.value+":"+a.value.replace(/^att\:/,"").trim()):"tax"===t.value||"cf"===t.value?l.push(t.value+":"+n.value.replace(/^(tax|cf)\:/,"").trim()):l.push(t.value),a.value="",a.classList.remove("selected"),n.value="",n.classList.remove("selected"),t.value="",t.classList.remove("selected"),t.classList.remove("select-attribute"),t.classList.remove("select-custom"),c(r=l)}},b("Add","wpt-block"))),g("div",{className:"barn2-wc-product-table-block__columns"},a)}})(window.wp,"undefined"!=typeof wcptbSettings?wcptbSettings:null);