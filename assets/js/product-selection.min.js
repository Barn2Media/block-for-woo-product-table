"use strict";function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,l,o=!0,n=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){n=!0,l=e},f:function(){try{o||null==r.return||r.return()}finally{if(n)throw l}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}(function(d,p,b){var v=d.i18n.__,e=d.element.createElement,t=d.components,f=t.Button,y=t.Icon,m=t.IconButton,w=t.ToggleControl,a=d.compose.withState,_=e;window.productTableBlockComponents||(window.productTableBlockComponents={});function h(e,t){var a=[];for(var r in a.push(_("option",{value:""},v("(Select a value)","wpt-block"))),e)if(t&&e[r].terms)for(var l in e[r].terms)a.push(_("option",{value:r+":"+l,"data-key":r},e[r].terms[l]));else isNaN(r)?a.push(_("option",{value:r},e[r].label)):a.push(_("option",{value:e[r]},e[r]));return a}function k(e){e.classList.remove("allow-multiple"),e.classList.remove("allow-andor");var t,a=_createForOfIteratorHelper(e.querySelectorAll("*[disabled]"));try{for(a.s();!(t=a.n()).done;){t.value.disabled=!1}}catch(e){a.e(e)}finally{a.f()}var r,l=_createForOfIteratorHelper(e.querySelectorAll("select,input"));try{for(l.s();!(r=l.n()).done;){var o=r.value;o.value="",o.classList.remove("visible"),o.classList.remove("selected"),o.classList.remove("ready")}}catch(e){l.e(e)}finally{l.f()}e.querySelector("ul").innerHTML=""}function g(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}function S(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}function L(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}var T={category:{label:"Category",andor:!0,for:"category",multiple:!0},tag:{label:"Tag",andor:!0,for:"tag",multiple:!0},cf:{label:"Custom Field",andor:!0,keypair:["Key","Value"],multiple:!0,for:"value"},term:{label:"Custom Taxonomy Term",keypair:["Taxonomy","Term"],multiple:!0,for:"value"},attr:{attr:"term",label:"Attribute",keypair:["Attribute","Term"],for:"attr",multiple:!0},year:{label:"Year",for:"value"},month:{label:"Month",for:"value"},day:{label:"Day",for:"value"},status:{label:"Product Status",for:"status",values:["publish","draft","private","pending","future","any"],multiple:!0},include:{label:"Include Products",description:"Separate Product IDs with a comma",for:"value"},exclude:{label:"Exclude Products",description:"Separate Product IDs with a comma",for:"value"},exclude_category:{andor:!0,label:"Exclude Category",for:"category",multiple:!0},"user_products=true":{label:"Previously Ordered Products"}};window.productTableBlockComponents.ProductSelection=a({isMatchall:!1,count:null})(function(e){var t=e.isMatchall,a=e.count,r=e.attributes,l=e.saveFilters,o=e.setState;d.apiFetch.use(d.apiFetch.createNonceMiddleware(p)),d.apiFetch({path:"/wc-product-table/v1/count",method:"POST",data:{attrs:r}}).then(function(e){null!=a&&e.count===a||o({count:e.count})});function n(e){var t=JSON.parse(JSON.stringify(c));t.push(e),k(u.current),l(t)}var c=r.filters,s=d.element.createRef(),u=d.element.createRef(),i=[_("h3",{},[v("Products","wpt-block"),_("em",{},null!=a?"".concat(a," products found"):"Finding products...")]),_("ul",{className:"barn2-wc-product-table-block__product-filters",ref:s},function(e){var t=e.filters,a=e.onDelete,r=[];for(var l in t){var o=t[l].value.replace(/,/g,", ").replace(/\+/g," + "),n=_("li",{"data-index":l,"data-key":t[l].key,"data-value":t[l].value,key:"table-column-"+l},[_(y,{icon:barn2_reorderIcon,alt:""}),_("span",{},[_("strong",{},T[t[l].key].label+": "),o]),_(m,{icon:barn2_deleteIcon,label:"Remove Selection","data-index":l,onClick:function(e){a(e.currentTarget.dataset.index)}})]);r.push(n)}return r}({filters:c,onDelete:function(e){var t=removeArrayIndex(c,e);l(t)}})),_("p",{className:"empty-options"},v("(Using global options)","wpt-block")),_("div",{className:"barn2-wc-product-table-block__new-filter-panel",ref:u},[_("select",{className:"barn2-wc-product-table-block__add-new-selection",onChange:function(e){(function(e,t){var a=e.currentTarget,r=a.value,l=a.querySelector('option[value="'.concat(r,'"]'));t.classList.remove("allow-multiple"),t.classList.remove("allow-andor"),a.classList.remove("selected");var o,n=_createForOfIteratorHelper(a.parentNode.querySelectorAll(".barn2-wc-product-table-block__new-option"));try{for(n.s();!(o=n.n()).done;){var c=o.value;c.classList.remove("visible"),c.value="",c.setAttribute("placeholder","")}}catch(e){n.e(e)}finally{n.f()}if(l.dataset.for){var s=a.parentNode.querySelector(".barn2-wc-product-table-block__new-option."+l.dataset.for);s.classList.add("visible"),l.dataset.multiple&&t.classList.add("allow-multiple"),l.dataset.andor&&t.classList.add("allow-andor"),l.dataset.description&&s.setAttribute("placeholder",l.dataset.description)}else a.classList.add("selected")})(e,u.current)}},function(){var e=[];for(var t in e.push(_("option",{value:""},v("(Select a product option to add)","wpt-block"))),T)e.push(_("option",{value:t,"data-for":T[t].for,"data-key":T[t].attr||t,"data-multiple":T[t].multiple,"data-andor":T[t].andor,"data-description":T[t].description},T[t].label));return e}()),_("select",{className:"barn2-wc-product-table-block__new-option category",onChange:g},h(b.categoryTerms)),_("select",{className:"barn2-wc-product-table-block__new-option status",onChange:g},h(T.status.values)),_("select",{className:"barn2-wc-product-table-block__new-option tag",onChange:g},h(b.tagTerms)),_("select",{className:"barn2-wc-product-table-block__new-option attr",onChange:function(e){(function(e,t){var a=e.currentTarget,r=t.querySelector("select.attr-values");""===a.value?(a.classList.remove("ready"),r.classList.remove("visible")):(a.classList.add("ready"),r.classList.add("visible")),r.value="";var l,o=_createForOfIteratorHelper(r.querySelectorAll("option"));try{for(o.s();!(l=o.n()).done;){var n=l.value;n.dataset.key===a.value?n.style.display="":n.style.display="none"}}catch(e){o.e(e)}finally{o.f()}})(e,u.current)}},h(b.attributes)),_("select",{className:"barn2-wc-product-table-block__new-option attr-values",onChange:S},h(b.attributes,!0)),_("input",{className:"barn2-wc-product-table-block__new-option value",onChange:L}),_(f,{className:"is-secondary barn2-wc-product-table-block__add-filter-button",onClick:function(){(function(e,t){var a=e.querySelector(".barn2-wc-product-table-block__add-new-selection"),r=e.querySelector(".barn2-wc-product-table-block__new-option.selected");if(a.disabled=!0,e.classList.contains("allow-multiple")){var l=e.querySelector("ul"),o=document.createElement("li");if(o.innerHTML=r.value,o.dataset.value=r.value,l.append(o),a.disabled=!0,r.value="",r.classList.remove("selected"),"SELECT"===r.tagName){var n=r.querySelector('option[value="'.concat(r.value,'"]'));n&&(n.disabled=!0)}}else{var c=a.value.split("="),s=c[0],u=1<c.length?c[1]:"";1===c.length&&(u=r.value),t({key:s,value:u})}})(u.current,n)}},v("Add","wpt-block")),_("ul",{className:"barn2-wc-product-table-block__new-filter-selections"}),_(w,{className:"barn2-wc-product-table-block__andor-toggle",label:v("Match all","wpt-block"),checked:t,onChange:function(){o({isMatchall:!t})}}),_(f,{className:"is-primary barn2-wc-product-table-block__save-filter-button",onClick:function(){var e=function(e,t){var a,r,l=e.querySelector(".barn2-wc-product-table-block__add-new-selection"),o=e.querySelectorAll("ul li"),n=l.querySelector('option[value="'.concat(l.value,'"]'));if(o.length){a=n.dataset.key;var c,s=e.classList.contains("allow-andor")&&t?"+":",",u=[],i=_createForOfIteratorHelper(o);try{for(i.s();!(c=i.n()).done;){var d=c.value;u.push(d.dataset.value)}}catch(e){i.e(e)}finally{i.f()}r=u.join(s)}else{var p=n.dataset.key.split("=");a=p[0],r=1<p.length?p[1]:""}return{key:a,value:r}}(u.current,t);n(e)}},v("Add Selection to Table","wpt-block")),_(f,{className:"is-secondary barn2-wc-product-table-block__save-filter-button",onClick:function(){k(u.current)}},v("Reset","wpt-block"))])];return waitForReference(s,function(t){if(!t.classList.contains("ui-sortable")){var a=jQuery(t);a.sortable({update:function(){var e=function(e){for(var t=[],a=e.querySelectorAll("li"),r=0;r<a.length;r+=1)t.push({key:a[r].dataset.key,value:a[r].dataset.value});return t}(t);console.log(e),a.sortable("cancel"),l(e)}})}}),_("div",{className:"barn2-wc-product-table-block__products"},i)})})(window.wp,"undefined"!=typeof wcptbNonce?wcptbNonce:null,"undefined"!=typeof wcptbCatalog?wcptbCatalog:null);