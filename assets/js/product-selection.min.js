"use strict";function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,r,o=!0,n=!1;return{s:function(){l=e[Symbol.iterator]()},n:function(){var e=l.next();return o=e.done,e},e:function(e){n=!0,r=e},f:function(){try{o||null==l.return||l.return()}finally{if(n)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}(function(d,p,b){var v=d.i18n.__,e=d.element.createElement,t=d.components,f=t.Button,m=(t.Icon,t.IconButton),y=(t.TextControl,t.ToggleControl),a=d.compose.withState,w=e;window.productTableBlockComponents||(window.productTableBlockComponents={});function _(e,t,a){var l=[];for(var r in l.push(w("option",{value:""},v(t,"wpt-block"))),e)if(a&&e[r].terms)for(var o in e[r].terms)l.push(w("option",{value:r+":"+o,"data-key":r},e[r].terms[o]));else isNaN(r)?l.push(w("option",{value:r},e[r].label)):l.push(w("option",{value:e[r]},e[r]));return l}function g(e){e.classList.remove("allow-multiple"),e.classList.remove("allow-andor"),e.classList.remove("has-multiple");var t,a=_createForOfIteratorHelper(e.querySelectorAll("*[disabled]"));try{for(a.s();!(t=a.n()).done;){t.value.disabled=!1}}catch(e){a.e(e)}finally{a.f()}var l,r=_createForOfIteratorHelper(e.querySelectorAll("select,input"));try{for(r.s();!(l=r.n()).done;){var o=l.value;o.value="",o.classList.remove("visible"),o.classList.remove("selected"),o.classList.remove("ready")}}catch(e){r.e(e)}finally{r.f()}e.querySelector("ul").innerHTML=""}function h(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}function k(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}function L(e){var t=e.currentTarget;""===t.value?t.classList.remove("selected"):t.classList.add("selected")}var S={category:{label:"Category",andor:!0,for:"category",multiple:!0,selectLabel:"Add category"},tag:{label:"Tag",andor:!0,for:"tag",multiple:!0,selectLabel:"Add tag"},cf:{label:"Custom Field",andor:!0,keypair:["Key","Value"],multiple:!0,for:"value"},term:{label:"Custom Taxonomy Term",keypair:["Taxonomy","Term"],multiple:!0,for:"value"},attr:{attr:"term",andor:!0,label:"Attribute",keypair:["Attribute","Term"],for:"attr",multiple:!0,selectLabel:"Add global attribute"},year:{label:"Year",for:"value"},month:{label:"Month",for:"value"},day:{label:"Day",for:"value"},status:{label:"Product Status",for:"status",values:["publish","draft","private","pending","future","any"],multiple:!0},include:{label:"Include Products",description:"Product IDs",for:"value",selectLabel:"Add product"},exclude:{label:"Exclude Products",description:"Product IDs",for:"value",selectLabel:"Exclude product"},exclude_category:{andor:!0,label:"Exclude Category",for:"category",multiple:!0,selectLabel:"Exclude category"},user_products:{label:"Previously Ordered Products",value:"true",valueLabel:"Enabled"}};window.productTableBlockComponents.ProductSelection=a({isMatchall:!1,count:null})(function(e){var t=e.isMatchall,a=e.count,l=e.attributes,r=e.saveFilters,o=e.setState;d.apiFetch.use(d.apiFetch.createNonceMiddleware(p)),d.apiFetch({path:"/wc-product-table/v1/count",method:"POST",data:{attrs:l}}).then(function(e){null!=a&&e.count===a||o({count:e.count})});function n(e){var t=JSON.parse(JSON.stringify(c));t.push(e),g(u.current),r(t)}var c=l.filters,s=d.element.createRef(),u=d.element.createRef();null!=a&&100<=a&&(a="At least 100");var i=[w("h3",{},[v("Products","wpt-block"),w("em",{},null!=a?"".concat(a," products found"):"Finding products...")]),w("ul",{className:"barn2-wc-product-table-block__product-filters",ref:s},function(e){var t=e.filters,a=e.onDelete,l=[];for(var r in t){var o=t[r].value.replace(/,/g,", ").replace(/\+/g," + ");S[t[r].key].valueLabel&&(o=S[t[r].key].valueLabel);var n=w("li",{"data-index":r,"data-key":t[r].key,"data-value":t[r].value,key:"table-column-"+r},[w("span",{},[w("strong",{},S[t[r].key].label+": "),o]),w(m,{icon:barn2_deleteIcon,label:"Remove Selection","data-index":r,onClick:function(e){a(e.currentTarget.dataset.index)}})]);l.push(n)}return l}({filters:c,onDelete:function(e){var t=removeArrayIndex(c,e);r(t)}})),w("p",{className:"empty-options"},v("(Using global options)","wpt-block")),w("div",{className:"barn2-wc-product-table-block__new-filter-panel",ref:u},[w("select",{className:"barn2-wc-product-table-block__add-new-selection",onChange:function(e){(function(e,t){var a=e.currentTarget,l=a.value,r=a.querySelector('option[value="'.concat(l,'"]'));g(t),a.value=l;var o,n=_createForOfIteratorHelper(a.parentNode.querySelectorAll(".barn2-wc-product-table-block__new-option"));try{for(n.s();!(o=n.n()).done;){var c=o.value;c.classList.remove("visible"),c.value="",c.setAttribute("placeholder","")}}catch(e){n.e(e)}finally{n.f()}if(r.dataset.for){var s=a.parentNode.querySelector(".barn2-wc-product-table-block__new-option."+r.dataset.for);if(s.classList.add("visible"),r.dataset.multiple){t.classList.add("allow-multiple");var u=a.parentNode.querySelector(".barn2-wc-product-table-block__new-filter-selection-label"),i=a.parentNode.querySelector(".barn2-wc-product-table-block__add-filter-button");u&&(u.innerHTML=r.innerHTML+" "+v("Selections","wpt-block")),i&&(i.innerHTML=v("Add","wpt-block"))}r.dataset.andor&&t.classList.add("allow-andor"),r.dataset.description&&s.setAttribute("placeholder",r.dataset.description)}else a.classList.add("selected")})(e,u.current)}},function(){var e=[];for(var t in e.push(w("option",{value:""},v("Select products","wpt-block"))),S)e.push(w("option",{value:t,"data-for":S[t].for,"data-key":S[t].attr||t,"data-multiple":S[t].multiple,"data-andor":S[t].andor,"data-description":S[t].description,"data-value":S[t].value},S[t].label));return e}()),w("strong",{className:"barn2-wc-product-table-block__new-filter-selection-label"},""),w("ul",{className:"barn2-wc-product-table-block__new-filter-selections"}),w(y,{className:"barn2-wc-product-table-block__andor-toggle",label:v("Products must match all values","wpt-block"),checked:t,onChange:function(){o({isMatchall:!t})}}),w("select",{className:"barn2-wc-product-table-block__new-option category",onChange:h},_(b.categoryTerms,"Select category")),w("select",{className:"barn2-wc-product-table-block__new-option status",onChange:h},_(S.status.values,"Select status")),w("select",{className:"barn2-wc-product-table-block__new-option tag",onChange:h},_(b.tagTerms,"Select tag")),w("select",{className:"barn2-wc-product-table-block__new-option attr",onChange:function(e){(function(e,t){var a=e.currentTarget,l=t.querySelector("select.attr-values");""===a.value?(a.classList.remove("ready"),l.classList.remove("visible")):(a.classList.add("ready"),l.classList.add("visible")),l.value="";var r,o=_createForOfIteratorHelper(l.querySelectorAll("option"));try{for(o.s();!(r=o.n()).done;){var n=r.value;n.dataset.key===a.value?n.style.display="":n.style.display="none"}}catch(e){o.e(e)}finally{o.f()}})(e,u.current)}},_(b.attributes,"Select global attribute")),w("select",{className:"barn2-wc-product-table-block__new-option attr-values",onChange:k},_(b.attributes,"Select attribute value",!0)),w("input",{className:"barn2-wc-product-table-block__new-option components-text-control__input value",onChange:L}),w(f,{className:"is-secondary barn2-wc-product-table-block__add-filter-button",onClick:function(){(function(t){var e=t.querySelector(".barn2-wc-product-table-block__add-new-selection"),a=t.querySelector(".barn2-wc-product-table-block__new-option.selected");e.disabled=!0;var l=t.querySelector("ul"),r=document.createElement("li");r.innerHTML="<span>"+a.value+"</span>",r.dataset.value=a.value;var o=document.createElement("button");if(o.classList.add("components-button"),o.classList.add("has-icon"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12,2C6.486,2,2,6.486,2,12s4.486,10,10,10s10-4.486,10-10S17.514,2,12,2z M16.207,14.793l-1.414,1.414L12,13.414 l-2.793,2.793l-1.414-1.414L10.586,12L7.793,9.207l1.414-1.414L12,10.586l2.793-2.793l1.414,1.414L13.414,12L16.207,14.793z"/></svg>',o.addEventListener("click",function(e){r.remove(),l.children.length<2&&t.classList.remove("has-multiple")}),r.append(o),l.append(r),1<l.children.length&&t.classList.add("has-multiple"),e.disabled=!0,a.value="",a.classList.remove("selected"),"SELECT"===a.tagName){var n=a.querySelector('option[value="'.concat(a.value,'"]'));n&&(n.disabled=!0)}})(u.current)}},v("Select","wpt-block")),w("span",{className:"spacer"},""),w(f,{className:"is-primary barn2-wc-product-table-block__save-filter-button",onClick:function(){var e=function(e,t){var a,l,r=e.querySelector(".barn2-wc-product-table-block__add-new-selection"),o=e.querySelectorAll("ul li"),n=r.querySelector('option[value="'.concat(r.value,'"]'));if(o.length){a=n.dataset.key;var c,s=e.classList.contains("allow-andor")&&t?"+":",",u=[],i=_createForOfIteratorHelper(o);try{for(i.s();!(c=i.n()).done;){var d=c.value;u.push(d.dataset.value)}}catch(e){i.e(e)}finally{i.f()}l=u.join(s)}else if(!e.classList.contains("allow-multiple")){e.querySelector(".barn2-wc-product-table-block__new-option.selected");if(n.dataset.value&&0<n.dataset.value.length)a=r.value,l=n.dataset.value;else{var p=e.querySelector(".barn2-wc-product-table-block__new-option.selected"),b=r.value.split("=");a=b[0],l=1<b.length?b[1]:"",1===b.length&&(l=p.value)}}return{key:a,value:l}}(u.current,t);n(e)}},v("Done","wpt-block")),w(f,{className:"is-secondary barn2-wc-product-table-block__reset-filter-button",onClick:function(){g(u.current)}},v("Cancel","wpt-block"))])];return w("div",{className:"barn2-wc-product-table-block__products"},i)})})(window.wp,"undefined"!=typeof wcptbNonce?wcptbNonce:null,"undefined"!=typeof wcptbCatalog?wcptbCatalog:null);